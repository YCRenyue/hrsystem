# 人力资源管理系统 - 测试文档

## 系统概述

这是一个企业级人力资源管理系统，具有员工管理、部门管理、入职管理等功能。系统采用前后端分离架构，前端使用 React + TypeScript，后端使用 Node.js + Express。

## 测试环境配置

### 1. 启动数据库

确保 MySQL 和 Redis 服务已启动。

### 2. 初始化数据库

首先运行数据库迁移和种子脚本：

```bash
# 进入后端目录
cd backend

# 运行数据库迁移
npm run db:migrate

# 运行种子脚本（创建测试数据）
npm run db:seed
```

### 3. 启动服务

```bash
# 在项目根目录，启动前后端
npm run dev

# 或分别启动
npm run dev:backend  # 后端: http://localhost:3001
npm run dev:frontend # 前端: http://localhost:3000
```

## 测试账号

系统提供了四种角色的测试账号，所有账号的默认密码都是：**password123**

### 1. 系统管理员账号

- **用户名**: `admin`
- **密码**: `password123`
- **角色**: 系统管理员
- **权限**: 完全权限（所有功能）
- **说明**: 可以访问所有功能，包括用户管理、权限配置等

### 2. 人力资源管理员账号

- **用户名**: `hr_admin`
- **密码**: `password123`
- **角色**: 人力资源管理员
- **权限**:
  - 员工信息管理（读写）
  - 部门信息查看
  - 入职流程管理
  - Excel 导入导出
- **说明**: 负责日常的人力资源管理工作

### 3. 部门经理账号

- **用户名**: `manager`
- **密码**: `password123`
- **角色**: 部门经理
- **权限**:
  - 员工信息查看
  - 部门信息查看
- **说明**: 可以查看员工和部门信息，但无修改权限

### 4. 普通员工账号

- **用户名**: `employee`
- **密码**: `password123`
- **角色**: 普通员工
- **权限**:
  - 查看和编辑个人信息
- **说明**: 只能查看和修改自己的信息

## 功能测试指南

### 1. 登录功能测试

1. 访问 http://localhost:3000
2. 使用任意测试账号登录
3. 验证登录成功后跳转到仪表板
4. 验证用户信息显示正确

**测试点**：
- ✓ 正确的用户名和密码可以登录
- ✓ 错误的用户名或密码显示错误提示
- ✓ 登录后显示对应角色的菜单和权限

### 2. 员工管理功能测试

使用 `admin` 或 `hr_admin` 账号测试。

#### 2.1 查看员工列表

1. 登录后点击左侧菜单"员工管理"
2. 验证员工列表显示正常
3. 测试搜索功能（按姓名、邮箱或员工编号）
4. 测试筛选功能（按状态筛选）
5. 测试分页功能

**测试数据**：
系统已创建两个示例员工：
- 员工编号：EMP001，姓名：张三，部门：研发部
- 员工编号：EMP002，姓名：李四，部门：人力资源部

#### 2.2 添加新员工

1. 点击"添加员工"按钮
2. 填写员工信息：
   - 员工编号：EMP003（必填）
   - 姓名：王五（必填）
   - 邮箱：wangwu@hrsystem.com
   - 手机号：13900000003
   - 性别：男
   - 部门：研发部（必填）
   - 职位：软件工程师（必填）
   - 雇佣类型：全职（必填）
   - 入职日期：选择今天（必填）
3. 点击"创建员工信息"
4. 验证员工创建成功并返回列表

**测试点**：
- ✓ 必填字段验证
- ✓ 邮箱格式验证
- ✓ 手机号格式验证
- ✓ 身份证号格式验证（18位）
- ✓ 重复员工编号提示错误

#### 2.3 编辑员工信息

1. 在员工列表中点击"编辑"按钮
2. 修改员工信息（如职位、邮箱等）
3. 点击"更新员工信息"
4. 验证信息更新成功

#### 2.4 删除员工

使用 `admin` 账号（只有管理员有删除权限）：

1. 在员工列表中点击"删除"按钮
2. 确认删除提示
3. 验证员工被删除

### 3. Excel 导入导出功能测试

使用 `admin` 或 `hr_admin` 账号测试。

#### 3.1 导出员工数据

1. 在员工列表页面点击"导出 Excel"
2. 验证 Excel 文件下载成功
3. 打开 Excel 文件，验证数据格式正确
4. 验证包含以下列：
   - 员工编号、姓名、邮箱、手机号、身份证号
   - 性别、出生日期、部门、职位、雇佣类型
   - 入职日期、状态

**注意**：
- 管理员和HR可以看到完整的敏感信息（手机号、身份证号）
- 其他角色看到的是脱敏数据（如手机号显示为 138****8888）

#### 3.2 导入员工数据

1. 准备 Excel 文件，格式参考导出的文件
2. Excel 应包含以下列（顺序必须一致）：
   - 员工编号（必填）
   - 姓名（必填）
   - 邮箱
   - 手机号
   - 身份证号
   - 性别
   - 出生日期
   - 部门ID
   - 职位
   - 雇佣类型
   - 入职日期
   - 状态

3. 点击"导入 Excel"按钮
4. 选择准备好的 Excel 文件
5. 验证导入成功并显示导入结果（成功数量、失败数量）
6. 查看员工列表，验证数据导入正确

**示例 Excel 数据**：

| 员工编号 | 姓名 | 邮箱 | 手机号 | 身份证号 | 性别 | 出生日期 | 部门ID | 职位 | 雇佣类型 | 入职日期 | 状态 |
|---------|------|------|--------|----------|------|----------|--------|------|----------|----------|------|
| EMP004 | 赵六 | zhaoliu@test.com | 13900000004 | 110101199203031234 | male | 1992-03-03 | 11111111-1111-1111-1111-111111111111 | 初级工程师 | full_time | 2024-01-01 | probation |

**测试点**：
- ✓ 正确格式的文件可以导入
- ✓ 缺少必填字段的行显示错误
- ✓ 重复员工编号的行显示错误
- ✓ 导入结果显示成功和失败的数量

### 4. 部门管理功能测试

使用 `admin` 或 `hr_admin` 账号测试。

#### 4.1 查看部门列表

1. 点击左侧菜单"部门管理"
2. 验证部门列表显示
3. 系统已创建四个部门：
   - 研发部（RD）
   - 人力资源部（HR）
   - 市场部（MKT）
   - 财务部（FIN）

#### 4.2 添加部门

1. 点击"添加部门"按钮
2. 输入部门名称（如：运营部）
3. 点击"创建"
4. 验证部门创建成功

#### 4.3 编辑部门

1. 点击部门的"编辑"按钮
2. 修改部门名称
3. 点击"更新"
4. 验证部门更新成功

#### 4.4 删除部门

1. 点击部门的"删除"按钮
2. 确认删除
3. 验证部门被删除

**注意**：如果部门下有员工，应该禁止删除或提示错误（此功能可能需要实现）

### 5. 仪表板功能测试

1. 登录后默认显示仪表板
2. 验证统计数据显示：
   - 员工总数
   - 部门数量
   - 待入职人数
   - 完成率

**注意**：当前数据是静态的，实际应该从数据库查询

### 6. 权限测试

#### 6.1 测试不同角色的权限

1. 使用 `employee` 账号登录
2. 验证只能看到：
   - 仪表板
   - 个人信息（如果实现）
3. 验证无法访问：
   - 员工管理
   - 部门管理
   - 添加/编辑/删除功能

4. 使用 `manager` 账号登录
5. 验证可以查看员工和部门列表
6. 验证无法进行添加/编辑/删除操作

#### 6.2 测试未授权访问

1. 退出登录
2. 尝试直接访问 http://localhost:3000/employees
3. 验证被重定向到登录页面

## 数据安全与加密测试

### 敏感数据加密

系统使用 AES-256-GCM 加密以下敏感字段：
- 员工姓名
- 手机号
- 身份证号
- 银行卡号
- 出生日期

### 密码安全

- 所有密码使用 bcrypt 加密存储（salt rounds: 10）
- 密码不会以明文形式存储或传输
- 测试账号的密码是 `password123`，存储在数据库中的是 bcrypt 哈希值

### 数据脱敏测试

1. 使用 `employee` 或 `manager` 账号登录
2. 查看员工列表
3. 验证敏感信息被脱敏显示：
   - 手机号：138****8888
   - 身份证号：110***********1234

4. 使用 `admin` 或 `hr_admin` 账号登录
5. 验证可以看到完整的敏感信息

## API 接口测试

### 认证接口

#### 登录
```bash
POST http://localhost:3001/api/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "password123"
}
```

**响应**：
```json
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "user_id": "...",
      "username": "admin",
      "role": "admin",
      ...
    }
  }
}
```

### 员工接口

所有请求需要在 Header 中携带 JWT token：
```
Authorization: Bearer <token>
```

#### 获取员工列表
```bash
GET http://localhost:3001/api/employees?page=1&size=10
```

#### 创建员工
```bash
POST http://localhost:3001/api/employees
Content-Type: application/json

{
  "employee_number": "EMP005",
  "name": "测试员工",
  "email": "test@hrsystem.com",
  "phone": "13900000005",
  "department_id": "11111111-1111-1111-1111-111111111111",
  "position": "测试工程师",
  "employment_type": "full_time",
  "entry_date": "2024-01-01",
  "gender": "male"
}
```

#### 导出 Excel
```bash
GET http://localhost:3001/api/employees/export
```

#### 导入 Excel
```bash
POST http://localhost:3001/api/employees/import
Content-Type: multipart/form-data

file: <Excel文件>
```

## 常见问题

### 1. 登录失败

**问题**：使用测试账号无法登录

**解决方案**：
1. 确认已运行 `npm run db:seed` 创建测试账号
2. 检查密码是否正确（默认：password123）
3. 检查后端服务是否正常运行
4. 查看浏览器控制台和后端日志

### 2. 数据库连接失败

**问题**：后端启动时报数据库连接错误

**解决方案**：
1. 确认 MySQL 服务已启动
2. 检查 `.env` 文件中的数据库配置
3. 确认数据库用户名和密码正确
4. 确认数据库已创建（默认：hrsystem）

### 3. Excel 导入失败

**问题**：导入 Excel 文件时报错

**解决方案**：
1. 检查 Excel 文件格式是否正确（应为 .xlsx 格式）
2. 确认列的顺序与要求一致
3. 检查必填字段是否都有值
4. 查看后端日志了解具体错误信息

### 4. 权限不足

**问题**：操作时提示权限不足

**解决方案**：
1. 确认使用的账号角色是否有相应权限
2. 某些操作（如删除员工）只有 admin 角色可以执行
3. Excel 导入导出需要 admin 或 hr_admin 角色

### 5. 端口被占用

**问题**：启动服务时提示端口被占用

**解决方案**：
1. 前端默认端口 3000，后端默认端口 3001
2. 可以在 `.env` 文件中修改端口
3. 或者关闭占用端口的进程

## 测试检查清单

使用此清单确保所有功能都经过测试：

### 基础功能
- [ ] 登录功能（正确和错误的凭据）
- [ ] 退出登录
- [ ] 仪表板数据显示

### 员工管理
- [ ] 查看员工列表
- [ ] 搜索员工
- [ ] 筛选员工（按状态）
- [ ] 分页功能
- [ ] 添加新员工
- [ ] 编辑员工信息
- [ ] 删除员工

### 部门管理
- [ ] 查看部门列表
- [ ] 添加新部门
- [ ] 编辑部门
- [ ] 删除部门

### Excel 功能
- [ ] 导出员工数据到 Excel
- [ ] 从 Excel 导入员工数据
- [ ] 导入错误处理

### 权限控制
- [ ] admin 角色权限
- [ ] hr_admin 角色权限
- [ ] manager 角色权限
- [ ] employee 角色权限
- [ ] 未授权访问拦截

### 数据安全
- [ ] 密码加密存储
- [ ] 敏感数据加密
- [ ] 数据脱敏显示
- [ ] 基于权限的数据访问

### 用户体验
- [ ] 界面中文化
- [ ] 错误消息提示
- [ ] 成功操作反馈
- [ ] 响应式布局

## 附录

### 部门 ID 参考

在 Excel 导入或 API 调用时需要使用部门 ID：

- 研发部：`11111111-1111-1111-1111-111111111111`
- 人力资源部：`22222222-2222-2222-2222-222222222222`
- 市场部：`33333333-3333-3333-3333-333333333333`
- 财务部：`44444444-4444-4444-4444-444444444444`

### 自动化测试

系统已配置完整的自动化测试套件，包含单元测试、集成测试和覆盖率报告。

#### 运行所有测试

```bash
cd backend
npm run test:all
```

此命令将运行所有测试模块并生成详细报告：
- ✓ 认证模块测试（登录、登出、JWT验证、密码安全）
- ✓ 员工管理模块测试（CRUD、Excel导入导出、数据加密）
- ✓ 部门管理模块测试（CRUD、层级关系）

#### 运行单个测试模块

```bash
# 运行认证模块测试
cd backend
npx jest src/__tests__/auth.test.js

# 运行员工管理模块测试
npx jest src/__tests__/employees.test.js

# 运行部门管理模块测试
npx jest src/__tests__/departments.test.js
```

#### 运行测试并生成覆盖率报告

```bash
cd backend
npm run test:coverage
```

覆盖率报告将生成在 `backend/coverage/` 目录下，可以通过浏览器打开 `coverage/index.html` 查看详细报告。

#### 监听模式运行测试

```bash
cd backend
npm run test:watch
```

此模式会监听文件变化，自动重新运行相关测试。

#### 代码规范检查

```bash
cd backend
npm run lint        # 检查代码规范
npm run lint:fix    # 自动修复代码规范问题
```

### 测试数据重置

如需重置测试数据，重新运行种子脚本：

```bash
cd backend
npm run db:seed
```

**警告**：此操作会清空所有现有数据！

---

**文档版本**：1.1
**最后更新**：2025-01-09
**维护者**：开发团队
