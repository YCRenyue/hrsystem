-- =============================================
-- HR系统数据库初始化脚本
-- 说明: 按正确顺序创建所有数据表
-- 执行方式: mysql -u root -p hr_system < init_all_tables.sql
-- =============================================

-- 创建数据库（如果不存在）
CREATE DATABASE IF NOT EXISTS hr_system 
    DEFAULT CHARACTER SET utf8mb4 
    COLLATE utf8mb4_unicode_ci;

USE hr_system;

-- 禁用外键检查（创建表时）
SET FOREIGN_KEY_CHECKS = 0;

-- =============================================
-- 1. 部门表（基础表，被员工表引用）
-- =============================================
SOURCE 02_departments.sql;

-- =============================================
-- 2. 员工表（核心表）
-- =============================================
SOURCE 01_employees.sql;

-- =============================================
-- 3. 用户权限表
-- =============================================
SOURCE 11_users.sql;

-- =============================================
-- 4. 入职流程表
-- =============================================
SOURCE 03_onboarding_processes.sql;

-- =============================================
-- 5. 考勤记录表
-- =============================================
SOURCE 04_attendance_records.sql;

-- =============================================
-- 6. 年假管理表
-- =============================================
SOURCE 05_annual_leaves.sql;

-- =============================================
-- 7. 社保公积金表
-- =============================================
SOURCE 06_social_security.sql;

-- =============================================
-- 8. 出差补助表
-- =============================================
SOURCE 07_business_trip_allowances.sql;

-- =============================================
-- 9. 就餐记录表
-- =============================================
SOURCE 08_meal_records.sql;

-- =============================================
-- 10. 文档管理表
-- =============================================
SOURCE 09_documents.sql;

-- =============================================
-- 11. 操作日志表
-- =============================================
SOURCE 10_audit_logs.sql;

-- 启用外键检查
SET FOREIGN_KEY_CHECKS = 1;

-- =============================================
-- 显示所有创建的表
-- =============================================
SHOW TABLES;

-- =============================================
-- 显示表结构统计
-- =============================================
SELECT 
    TABLE_NAME AS '表名',
    TABLE_ROWS AS '估计行数',
    ROUND(DATA_LENGTH / 1024 / 1024, 2) AS '数据大小(MB)',
    ROUND(INDEX_LENGTH / 1024 / 1024, 2) AS '索引大小(MB)',
    TABLE_COMMENT AS '说明'
FROM information_schema.TABLES
WHERE TABLE_SCHEMA = 'hr_system'
ORDER BY TABLE_NAME;

-- =============================================
-- 初始化完成提示
-- =============================================
SELECT 'HR系统数据库初始化完成' AS '状态';
SELECT CONCAT('共创建 ', COUNT(*), ' 张表') AS '统计信息'
FROM information_schema.TABLES
WHERE TABLE_SCHEMA = 'hr_system';
